<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough">

    <f:metadata>
        <f:viewAction action="#{loginBean.setHideHeaderRecordControls(false)}"/>
    </f:metadata>
    
    <h:body>
        
        <ui:composition template="./../../WEB-INF/templates/JUR_SideBarTemplate.xhtml">
            
            <ui:define name="content">
                <div class="content" id="content" style="display:none;">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="header">
                                    <h4 class="title">
                                        Editar Recurso Humano
                                    </h4>
                                <!--<p class="category">Listado</p>-->
                                </div>
                                <div class="content">
                                    <h:form id="mainForm">
                                        <h:inputHidden id="idHidden" value="#{recursosHumanosCRS.rowID}"/>
                                        <div class="row">
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <h:outputLabel>ID</h:outputLabel>
                                                    <h:inputText id="modelID" styleClass="form-control" a:placeholder="ID" disabled="true" value="#{recursosHumanosCVS.model.id_JUR_RecursoHumano}" rendered="#{recursosHumanosCVS.model.id_JUR_RecursoHumano!=0}"/>
                                                    <h:inputText styleClass="form-control" a:placeholder="ID" disabled="true" rendered="#{recursosHumanosCVS.model.id_JUR_RecursoHumano==0}"/>
                                                </div>
                                            </div>
                                            <div class="col-md-5">
                                                <div class="form-group">
                                                    <h:outputLabel>Nombre(s)</h:outputLabel>
                                                    <h:inputText id="NM" styleClass="form-control" a:placeholder="Nombre" value="#{recursosHumanosCVS.model.nombre}">
                                                        <f:ajax event="change" listener="#{recursosHumanosCVS.checkForChanges}" render="mainForm:mainFormBtnF"/>
                                                    </h:inputText>
                                                </div>
                                            </div>
                                            <div class="col-md-5">
                                                <div class="form-group">
                                                    <h:outputLabel>Apellido(s)</h:outputLabel>
                                                    <h:inputText id="AP" styleClass="form-control" a:placeholder="Apellidos" value="#{recursosHumanosCVS.model.apellidos}">
                                                        <f:ajax event="change" listener="#{recursosHumanosCVS.checkForChanges}" render="mainForm:mainFormBtnF"/>
                                                    </h:inputText>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <h:outputLabel>Tipo</h:outputLabel>
                                                            <h:selectOneMenu id="IN" styleClass="form-control" a:placeholder="Puesto" value="#{recursosHumanosCVS.model.interno}">
                                                                <f:selectItem itemValue="true" itemLabel="Interno"/>
                                                                <f:selectItem itemValue="flase" itemLabel="Externo"/>
                                                                <f:ajax event="change" listener="#{recursosHumanosCVS.checkForChanges}" render="mainForm:mainFormBtnF"/>
                                                            </h:selectOneMenu>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <h:outputLabel>Puesto</h:outputLabel>
                                                            <h:inputText id="PU" styleClass="form-control" a:placeholder="Puesto" value="#{recursosHumanosCVS.model.puesto}">
                                                                <f:ajax event="change" listener="#{recursosHumanosCVS.checkForChanges}" render="mainForm:mainFormBtnF"/>
                                                            </h:inputText>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-8">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <h:outputLabel>Observaciones</h:outputLabel>
                                                            <h:inputTextarea id="OB" styleClass="form-control" a:placeholder="Observaciones" value="#{recursosHumanosCVS.model.observaciones}">
                                                                <f:ajax event="change" listener="#{recursosHumanosCVS.checkForChanges}" render="mainForm:mainFormBtnF"/>
                                                            </h:inputTextarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <h:commandButton id="mainFormBtn" value="Guardar Cambios" style="display:none;">
                                            <f:ajax listener="#{recursosHumanosCVS.updateFormServicios}" render="mainForm formu" onevent="reRunJSCode"/>
                                        </h:commandButton>
                                        <h:commandButton id="mainFormBtnF" class="#{recursosHumanosCVS.cambios?'btn btn-success btn-fill pull-right':'btn btn-success pull-right'}" value="Guardar Cambios" onclick="fromAction(#{recursosHumanosCVS.cambios});return false;"/>
                                        <div class="clearfix"/>
                                    </h:form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="header-with-icon">
                                    <div class="col-md-11">
                                        <h4 class="title">Tareas asignadas</h4>
                                    </div>
                                    <div class="col-md-1" style="text-align:right">
                                        <i class="pe-7s-plus" data-msg="un caso (y una etapa, de ser necesario)" onclick="addPortalRow('pTarea',6,new Array('calendar','1,2','select','3,4','textarea','6_3'));"/>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="content table-responsive table-full-width">
                                        <h:form id="pTareaF" style="position:absolute;z-index:-999">
                                            <h:inputHidden id="commit" value="#{recursosHumanosCVS.portalValues}"/>
                                            <h:selectOneMenu id="prvL1" styleClass="form-control" a:size="#{recursosHumanosCVS.casosLength>10?10:recursosHumanosCVS.casosLength}" style="width:0;opacity:0;">
                                                <f:selectItems value="#{recursosHumanosCVS.casos}" var="c1" itemValue="#{c1.id_JUR_Caso}" itemLabel="#{c1.nombre}"/>
                                                <f:ajax event="focus" render="prvL1" listener="#{recursosHumanosCVS.loadCasosList}" onevent="function(data){loadSourceSelect(data,trNumber,'pTareaF\\:prvL1');}" disabled="#{recursosHumanosCVS.casosLength>0}"/>
                                                <f:ajax event="change" execute="commit" render="prvL2" listener="#{recursosHumanosCVS.loadEtapasForPortal}" onevent="function(data){if(data.status==='success')onCasoChange(this,true);}"/>
                                            </h:selectOneMenu>
                                            <h:selectOneMenu id="prvL2" styleClass="form-control" a:size="#{recursosHumanosCVS.etapas.list.size()>10?10:recursosHumanosCVS.etapas.list.size()}" style="width:0;opacity:0;">
                                                <f:selectItems value="#{recursosHumanosCVS.etapas.list}" var="c" itemValue="#{c.id}" itemLabel="#{c.label}"/>
                                            </h:selectOneMenu>
                                            <h:commandButton id="btn" style="display:none;">
                                                <f:ajax event="click" listener="#{recursosHumanosCVS.commitPortal}" execute="commit" render="commit" onevent="function(data){if(data.status==='success')replaceRowType(#{false},'@tableRowNumber');}"/>
                                            </h:commandButton>
                                            <h:commandButton id="btnD" style="display:none;">
                                                <f:ajax event="click" listener="#{recursosHumanosCVS.deleteFromPortal}" execute="commit" render="commit"/>
                                            </h:commandButton>
                                        </h:form>
                                        <table id="pTareaT" class="table table-hover table-striped portal" data-rows="#{recursosHumanosCVS.model.JUR_TareasLength}" data-sort="2_A">
                                            <thead id="pHead">
                                                <th width="10%" style="padding-left:1px;padding-right:1px;text-align:center">Asignación</th>
                                                <th width="10%" style="padding-left:1px;padding-right:1px;text-align:center">Entrega</th>
                                                <th width="12.5%" style="padding-left:1px;padding-right:1px;" data-events="change_onCasoChange(this);_select">Caso</th>
                                                <th width="12.5%" style="padding-left:1px;padding-right:1px;" data-events="click_onEtapaClick(this);_.styledSelect">Etapa</th>
                                                <th width="20%" style="padding-left:1px;padding-right:1px;">Asunto</th>
                                                <th width="25%" style="padding-left:1px;padding-right:1px;">Descripción</th>
                                                <th width="10%" style="padding-left:1px;padding-right:1px;"></th>
                                            </thead>
                                            <tbody id="pTarea" data-rows="#{recursosHumanosCVS.model.JUR_TareasLength}">
                                                <ui:repeat var="p" value="#{recursosHumanosCVS.model.JUR_Tareas}" varStatus="vs">
                                                    <tr data-row="#{vs.index+1}" style="width:100%">
                                                        <td data-id="#{p.id_JUR_Tarea}" class="calendar" style="padding-left:1px;padding-right:1px;width:10%;text-align:center" data-inFieldStyle="text-align:center;">#{p.fechaAsignacionString}</td>
                                                        <td class="calendar" style="padding-left:1px;padding-right:1px;width:10%;text-align:center" data-inFieldStyle="text-align:center;">#{p.fechaEntregaString}</td>
                                                        <td style="padding-left:1px;padding-right:1px;width:12.5%;" data-value="#{p.JUR_Caso.id_JUR_Caso}">#{p.JUR_Caso.nombre}</td>
                                                        <td style="padding-left:1px;padding-right:1px;width:12.5%;" data-value="#{p.JUR_Etapa.id_JUR_Etapa}">#{p.JUR_Etapa.nombre}</td>
                                                        <td style="padding-left:1px;padding-right:1px;width:20%;">#{p.asunto}</td>
                                                        <td style="padding-left:1px;padding-right:1px;width:25%;">#{p.descripcion}</td>
                                                        <td style='padding-left:1px;padding-right:1px;width:10%;padding:0'><center style='padding:0'><i class='inPortal pe-7s-note' onclick="editRow();"/><i class='inPortal pe-7s-trash' onclick="deleteFromPortal()"/></center></td>
                                                    </tr>
                                                </ui:repeat>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="clearfix"/>
                            </div>
                        </div>
                    </div>
                    <h:form id="deleteRecord" style="display:none;">
                        <h:commandLink id="Btn" onclick="return deletionAlert()" action="#{recursosHumanosCVS.deleteJUR_Casos()}">
                            <i class="pe-7s-trash"/>
                        </h:commandLink>
                    </h:form>
                </div>
            </div>
            <h:outputStylesheet library="css" name="portalsCSS.css"/>
            <h:outputStylesheet library="css" name="valuelists.css"/>
            <h:outputStylesheet library="css" name="bootstrap-datepicker3.css"/>
            <h:outputScript library="js" name="NumberFields.js"/>
            <h:outputScript library="js" name="valuelistcontrol.js"/>
            <h:outputScript library="js" name="bootstrap-datepicker.min.js"/>
            <h:outputScript library="js" name="bootstrap-datepicker.es.js"/>
            <h:outputScript library="js" name="portalActions.js"/>
            <script type="text/javascript">
                $(function(){
                    runJScode(false,true,true);
                    loadDatePickers();
                    $("#content").css("display","block");
                    $('a:not(#deleteRecordBtn,#deleteRecord\\:Btn,.dropdown-toggle)').click(function(e){
                        if($('#mainForm\\:mainFormBtnF.btn-fill').size()>0 || $(".modPR,.newPR").size()>0)
                            return confirm("No ha guardado los cambios realizados ¿Desea salir sin guardar?");
                        else return true;
                    });
                    var $tb=$("tbody").filter(function(){return this.id==='pTarea';});
                    $portalData={row:null,caso:null,form:$tb.parent().siblings('form').eq(0),tb:$tb};
                    $tb=$("#mainForm\\:OB");
                    $tb.height($tb.closest(".col-md-8").height()+4);
                });
                function reRunJScode()
                {
                    runJScode(true,true,true);
                    loadDatePickers();
                }
                function loadDatePickers(){
                    $('.date').each(function(){
                        var $dp=$(this);
                        var container=$dp.length>0 ? $dp.closest(".card") : "body";
                        $dp.datepicker({
                            language: 'es',
                            format: 'dd/mm/yyyy',
                            container: container,
                            showOnFocus: true,
                            todayHighlight: true,
                            autoclose: true
                        });
                    });
                }
                function onCasoChange($this,afterAjax)
                {
                    $this=$($this);
                    if(afterAjax)
                        loadSourceSelect({status:'success'},$portalData.row.data('row'),1,'pTareaF\\:prvL2');
                    else if($portalData.caso!=$this[0].value)
                        setSelectedCaso($this,$this.closest('tr'),$this[0].value,$portalData.form);
                }
                function setSelectedCaso($this,$row,caso,$form)
                {
                    $portalData.row=$row;
                    $portalData.caso=caso;
                    $form.find("#pTareaF\\:commit").val(caso);
                    $this.closest('td').next().find('option,li').remove();
                    $form.find('select').eq(0).trigger('onchange');
                }
                function onEtapaClick($this)
                {
                    $this=$($this);
                    var $p=$this.closest('td').prev(),
                        v=$p.data("value");
                    if(v!=null)
                        v=Number(v);
                    else v=$p.find(".styledSelect").next().children().filter(function(){return $(this).hasClass("selected");}).size();
                    if(1>v)
                    {
                        alert("Por favor seleccione un caso.");
                        $this.blur();
                    }
                    else if(1>$this.children().size())
                    {
                        setSelectedCaso($this,$this.closest('tr'),v,$portalData.form);
                    }
                }
                function deletionAlert()
                {
                    return confirm('¿Desea eliminar el material actual?');
                }
                function fromAction(p)
                {
                    if(p)
                        document.getElementById('mainForm:mainFormBtn').click();
                }
                function onClikVL(data,n,current)
                {
                    if(data.status==='success')
                    {
                        if(n===0)
                            document.getElementById(current).click();
                        else
                            afterAjaxSelect("mainForm\\:"+current,n); 
                    }
                }
                function reRunJSCode(d){
                    if(d.status==='success')
                    {
                        runJScode(true,false,true);
                        loadDatePickers();
                    }
                }
                function goToExpediente()
                {
                    var $target=$(event.target).next();
                    $target.val($("#mainForm\\:modelID").val());
                }
            </script>
            </ui:define>
        </ui:composition>
    </h:body>
    
</html>
